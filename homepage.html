<!DOCTYPE html>

<!--API KEY: RGAPI-ee9841e3-437d-429a-96bf-b962e011b31a -->
<!-- https://na1.api.riotgames.com/lol/summoner/v3/summoners/by-name/US%20Economy?api_key=RGAPI-0690f2d7-d1ea-4258-8dfe-74c442446b4e -->
<!-- https://na1.api.riotgames.com/lol/league/v3/positions/by-summoner/100311?api_key=RGAPI-0690f2d7-d1ea-4258-8dfe-74c442446b4e -->

<html lang="en">
<head>
	<meta charset="utf-8"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- icon library -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<style>

/*
 *  <color name="colorPrimaryLite">#009cb7</color>
 *  <color name="colorPrimaryLiter">#00aecc</color>
 *  <color name="colorPrimary">#00849b</color>
 *  <color name="colorPrimaryDark">#00849b</color>
 *  <color name="colorPrimaryTint">#16c8c8</color>
 *  <color name="colorPrimaryTint2">#00dfee</color>
 *  <color name="colorAccent">#f2d300</color>
 *  <color name="colorAccentDark">#f2d300</color>
 *
 */

 #header-title {
	color: #eeeeee;
 }
 
.balance {
	height:60vh;
}

.unselectable {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

ul {
  list-style: none;
}

#listing ul li {
	margin-bottom:10px;
	padding-left:10px;
	border: 1px solid #aaa;
	font-size: 20pt;
	height: 5vh;
}

.jumbotron {
	margin-right: 27vw;
	margin-left: 2vw;
	padding: 16px;
	height: 80vh;
	overflow: scroll;
	overflow-y: auto;
	overflow-x: auto;
}
.jumbotron p {
	margin-top: 10px;
	margin-left: 10px;
	margin-right: 10px;
}

.jumbotron h5 {
	margin-left: 10px;
	margin-right: 10px;
	margin-bottom: 15px;
}

h1 {
	margin-top:0px;
}

.error-text {
	color: white;
	background-color: red;
}

.success-text {
	color: green;
	background-color: inherit;
}

header {
	background:#00849b;
	margin:0px;
	padding-top:10px;
	padding-bottom:10px;
}

.summoner-btn {
	background: #00aecc;
}

.summoner-btn:hover {
	background: #009cb7;
}

.close {
	position: absolute;
	right: 20px;
	top: 0;
	color: #000;
	font-size: 35px;
	font-weight: bold;
}
.close:hover,.close:focus {
    color: red;
    cursor: pointer;
}

/********************** Styles for the Balance Grid **************************/
.balance-card {
	background: #009cb7;
	margin-bottom:10px;
	margin-right: 2vw;
	padding-left:10px;
	border: 1px solid #aaa;
	border-radius: 8px;
}

.profile-icon {
	max-width:100%;
	max-height:100%;
	padding-top: 4px;
	padding-left: 4px;
	padding-right: 15px;
	padding-bottom: 4px;
}

.balance-img-right {
    position: absolute;
    right: 50px;
    padding-right:0px;
    max-height: 100%;
    float: right;
}

.icon-btn {
	cursor:default;
	border-radius: 3px;
	max-height: 5vh;
	max-width: 5vw;
	padding: 0px;
	border: 2px solid #aaa;
	border-radius: 8px;
	background-color: #ffffff;
}
.icon-btn:hover {
	background-color: #CCCCCC;
}
.icon-btn:focus {
	outline: none;
}
.icon-btn-on {
	cursor: default;
	border-radius: 3px;
	max-height: 5vh;
	max-width: 5vw;
	padding: 0px;
	border: 2px solid #aaa;
	border-radius: 8px;
	background-color: #00aecc;
}
.icon-btn-on:hover {
	background-color: #009cb7;
}
.icon-btn-on:focus {
	outline: none;
}

.waiting-btn {
	cursor:default;
	border-radius: 3px;
	padding: 0px;
	border: 2px solid #aaa;
	border-radius: 8px;
	background-color: #ffffff;
}
.waiting-btn:hover {
	background-color: #CCCCCC;
}
.waiting-btn-on {
	cursor:default;
	border-radius: 3px;
	padding: 0px;
	border: 2px solid #aaa;
	border-radius: 8px;
	background-color: #00aecc;
}
.waiting-btn-on:hover {
	background-color: #009cb7;
}


/********************** Styles for the Friends List **************************/
/* search bar */
#friends {
	max-width: 22vw;
}

.friend-card span {
	right: 10px;
}

.search-container {
	position: relative;
	display: flex;
	flex-direction: row;
	overflow: hidden;
	padding-left: 4px;
	margin-top: 8px;
	margin-bottom: 6px;
	margin-right: 16px;
	font-size: 12px;
}

#search {
	margin-top: 20px;
}

#search-box {
	width:13vw;
}

/* scrolling list */
.scrollable ul {
	overflow:hidden;
	overflow-y:scroll;
	min-height:90vh;
	max-height:90vh;
	min-width:60%;
}

.right {
    position: fixed;
	 top: 0px;
	 right: 0px;
    width: 25vw;
}

#friends-list {
	border: 5px solid #00849b;
	background: #333;
	padding: 10px;
	margin: 0px;
}

#friends {
	background: #00849b;
}

#friends ul li {
	margin-bottom:10px;
	padding-left:10px;
	border: 1px solid #aaa;
	border-radius: 8px;
}

#friends ul li.up {
	border-color: #777;
	background: #ffffff;
}

#friends ul li.down {
	background: #009cb7;
}

#friends ul li.up:hover {
	border-color: #777;
	background: #00dfee;
}

#friends ul li.down:hover {
	border-color: #777;
	background: #00aecc;
}

#friends ul li:active {
	background: #eee;
	box-shadow: inset 0 1px 1px #666;
}

/* cards */
.flex-container {
	position: relative;
	display: flex;
	flex-direction: row;
	overflow: hidden;
	min-height: 5vw;
}

.card-img-right {
	position: absolute;
	right: 40px;
	padding-right:0px;
	padding-top: 3px;
	max-width: 4.0vw;
	float: right;
	padding-
}



/************************* Responsive design *********************************/
/* When the screen is less than 600px wide, stack the links and the search
   field vertically instead of horizontally */
@media screen and (max-width: 600px) {
    .jumbotron {
        float: none;
        display: none;
    }
}




/********************** Modal STUFF ************************************/
/* Center the image and position the close button */
#name-box {
	padding: 0px;	
	margin: 10px;
}
#chat-box {
	resize:vertical;
}

.modalcontainer {
	text-align: center;
	margin: 40px 0 12px 0;
	position: relative;
}
.avatar {
	width: 200px;
	height:200px;
	border-radius: 50%;
}

/* The Modal (background) */
.modal {
	display:none;
	position: fixed;
	z-index: 1;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	overflow: auto;
	background-color: rgba(0,0,0,0.4);
}

/* Modal Content Box */
.modal-content {
	background-color: #fefefe;
	margin: 4% auto 15% auto;
	border: 1px solid #888;
	width: 50%;
	padding-left: 15px;
	padding-right:15px;
	padding-bottom: 30px;
}

/* Add Zoom Animation */
.animate {
	animation: zoom 0.6s
}
@keyframes zoom {
    from {transform: scale(0)}
    to {transform: scale(1)}
}

.animate-grow {
	animation-name: grow;
	animation-duration: 5s;
	animation-iteration-count: infinite;
}
@keyframes grow {
    0%    {transform: scale(1);}
    15%   {transform: scale(1.09);}
    40%   {transform: scale(1);}
}

/* The Close Button (x) */
.popup-close {
	position: absolute;
	right: 20px;
	top: 0;
	color: #000;
	font-size: 35px;
	font-weight: bold;
	z-index: 2;
	opacity: .2;
}

.popup-close:hover,.popup-close:focus {
    color: red;
    cursor: pointer;
}

/* Tabs */
.tab {
	overflow: hidden;
	border: 1px solid #ccc;
	background-color: #f1f1f1;
}

.tablinks {
	width: 50%;
}

.tab button {
	background-color: inherit;
	float: left;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 14px 16px;
	transition: 0.3s;
}
.tab button:hover {
	background-color: #ddd;
}
.tab button.active {
	background-color: #ccc;
}
.tabcontent {
	display: none;
	padding: 6px 12px;
	border: 1px solid #ccc;
	border-top: none;
} 

.text-in {
	margin: 0 0 10px 0;
}

.block {
	text-align: center;
}
.equalspace {
	display: flex;
	justify-content: space-between;
}

.item-name {
	font-size: 1.3em;
}
.addtocart {
	font-size: 1.3em;
}

#add-friend-button {
	min-width: 50px;
	min-height: 50px;
	margin-right: 0px;
	margin-left: 20px;
	width:55px;
	height:35px;
	background: url("images/add_friend_gold2-512.png") no-repeat;
	display: inline-block;
}
#add-friend-button:hover {
	background: url("images/add_friend_gold2dark-512.png") no-repeat;
	cursor: pointer;
}

	</style>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
	</script>
	<script>

		function showPopup() {
			document.getElementById('modal-wrapper').style.display='block';
			var btn = $(".tab").children()[0];
			openInput({currentTarget:btn}, "Individual");
			var searchText = $("#search-box").val();
			$(".modal").find(".text-in").val('');
			$(".modal").find("#name-box").val(searchText);
			$(".modal").find("#chat-box").val('');
		}

		function openInput(event, id) {
			console.log("opeining " + id + " tab");
			$(".tabcontent").css("display", "none");
			$(".tablinks").removeClass("active");
			$("#"+id).css("display", "block");
			event.currentTarget.className += " active";
		}
		
		var AlliesSelected = 0;
		var RivalsSelected = 0;
		function AddRivalOnClick() {
						addToRivals(this);
		};
		function AddAllyOnClick() {
						addToAllies(this);
		};
		function allyOnClick() {
			var linkbtn = document.getElementById("link-btn");
			if (linkbtn.classList.contains("icon-btn")) {
				linkbtn.classList.add("icon-btn-on");
				linkbtn.classList.remove("icon-btn");
				AlliesSelected = 0;
				if (document.getElementById("rival-btn").classList.contains("icon-btn-on")) {
					rivalOnClick();
				}
				$("#waiting-list").children("li").each(function() {
					var waitingBtn = this;
					waitingBtn.classList.add("waiting-btn");
					
					$(this).off();
					$(this).on("click", function() {
						addToAllies(this);
					});
				});
			}
			else{
				linkbtn.classList.add("icon-btn");
				linkbtn.classList.remove("icon-btn-on");
				$("#waiting-list").children("li").each(function() {
					this.classList.remove("waiting-btn");
					$(this).off();
					if (this.classList.contains("waiting-btn-on")) {
						this.classList.remove("waiting-btn-on");
						//Create Allies with this element
						
						
					}
				});
			}
		}
		
		function rivalOnClick() {
			var rivalbtn = document.getElementById("rival-btn");
			if (rivalbtn.classList.contains("icon-btn")) {
				rivalbtn.classList.add("icon-btn-on");
				rivalbtn.classList.remove("icon-btn");
				RivalsSelected = 0;
				if (document.getElementById("link-btn").classList.contains("icon-btn-on")) {
					allyOnClick();
				}
				$("#waiting-list").children("li").each(function() {
					var waitingBtn = this;
					waitingBtn.classList.add("waiting-btn");
					
					$(this).off();
					$(this).on("click", function() {
						addToRivals(this);
					});
				});
			}
			else{
				rivalbtn.classList.add("icon-btn");
				rivalbtn.classList.remove("icon-btn-on");
				$("#waiting-list").children("li").each(function() {
					this.classList.remove("waiting-btn");
					$(this).off();
					if (this.classList.contains("waiting-btn-on")) {
						this.classList.remove("waiting-btn-on");
						//Create Rivals with this element
						
						
					}
				});
			}
		}
		
		function addToAllies(btnElem) {
			var waitingBtn = btnElem;
			if (waitingBtn.classList.contains("waiting-btn-on")) {
				waitingBtn.classList.add("waiting-btn");
				waitingBtn.classList.remove("waiting-btn-on");
				AlliesSelected--;
			}
			else if (AlliesSelected < 4) { 
				waitingBtn.classList.add("waiting-btn-on");
				waitingBtn.classList.remove("waiting-btn");
				AlliesSelected++;
				console.log("Added someone to Allies");
			}
			updateSelectedDisplay();
		}
		
		
		function addToRivals(btnElem) {
			var waitingBtn = btnElem;
			if (waitingBtn.classList.contains("waiting-btn-on")) {
				waitingBtn.classList.add("waiting-btn");
				waitingBtn.classList.remove("waiting-btn-on");
				RivalsSelected--;
			}
			else if (RivalsSelected < 2) { 
				waitingBtn.classList.add("waiting-btn-on");
				waitingBtn.classList.remove("waiting-btn");
				RivalsSelected++;
				console.log("Added someone to Rivals");
			}
			updateSelectedDisplay
			
		}
		
		function updateSelectedDisplay() {
			
		}

		function getRankString(tier, dev) {
			return tier + " " + dev;
		}

		function showPlayerList() {
			$("#listing").show();
			$("#balanced").hide();
			$("#back_btn").hide();
			$("#balance_btn").show();
		}

		function showBalanceGrid() {
			$("#listing").hide();
			$("#balanced").show();
			$("#back_btn").show();
			$("#balance_btn").hide();
			balanceTeams();
		}

		function getSrcByRank(rank) {
			return '/images/' + rank + '.png';
		}
		function getIndexByName(name) {
			for(var i=0; i<friends.length; i++) {
				if (friends[i].name === name) {
					return i;
				}
			}
			return -1;
		}

		function isEmptyOrSpaces(str) {
			if (typeof str == 'undefined') return true;
			return str === null || str.match(/^ *$/) !== null;
		}
		function display_friends() {
			console.log("generating friend-list html");
			$("#friends-list").empty();
			var indexMap = [];

			var search = $("#search-box").val();
			if (isEmptyOrSpaces(search)) {
				console.log("no search, showing all");
				toShow = friends;
				indexMap = Array.apply(null, {length: friends.length}).map(Number.call, Number)
			} else {
				console.log("filtering on search:" + search);
				search = search.toLowerCase();
				var toShow = friends.filter(function (el, index) {
					if (el.name.toLowerCase().includes(search) ||
						el.tear.toLowerCase().includes(search)) {
						indexMap.push(index);
						return true;
					}
					return false;
				});
			}

			if (toShow.length == 0) {
				showAddCard();
			} else {
				toShow.forEach(function(element, index) {
					var name = element.name;
					var playing = element.playing;
					var rank_str = getRankString(element.tear, element.dev);
					var rank_img_src = getSrcByRank(element.tear);
					appendFriend(indexMap[index], name, rank_str, rank_img_src);
				}); 
			}

		}

		function isFriendAlreadyAdded(summnerName) {
			if (friends.reduce(function (acumulator, currentValue) {
				if (acumulator || currentValue.name.toLowerCase() === summnerName.toLowerCase()) {
					return true;
				}
				return false;
			}, false)) {
				reportSummonerNotAdded(summnerName + " is already in the friends list");

				return true;
			}
			return false;
		}
		function addToFriendsList(inName, inTear, inDev) {
			console.log("adding friend with name:" + inName + " rank:" + inTear );
			friends.push({playing:false, name:inName, tear:inTear, dev:inDev});
			sortFriendsList();
			reportSummonerAdded(inName);
		}
		function sortFriendsList() {
			friends.sort(function (a, b) {
				if (b.name.toLowerCase() > a.name.toLowerCase()) {
					return -1;
				}
				return 1;
			});
			
		}
		function printFriends() {
			console.log("Printing Friends:");
			for (var i=0; i<friends.length; i++) {
				console.log("Friend[" + i + "]: "+ friends[i].name);
			}
		}

		jQuery.expr[':'].icontains = function(a, i, m) {
			return jQuery(a).text().toUpperCase()
				.indexOf(m[3].toUpperCase()) >= 0;
		};

		function addToActivePlayers(summonerName) {
			$(".friend-card:icontains('"+summonerName+"')").trigger("click");
			console.log("summonerName:" + summonerName);
		}
		function addPlayerToList(friendIndex) {
			incrementPlayers();

			friends[friendIndex].playing = true;
			appendPlayer(friends[friendIndex]);
		}

		var friends = [];
		var num_players = 0;
		$( document ).ready(function() {
			console.log("ready function executed");
			friends = [
						{playing:false, name:'Benjamin Davis', tear:'BRONZE', dev:2},
						{playing:false, name:'Bjergsen', tear:'CHALLENGER', dev:1},
						{playing:false, name:'Faker', tear:'SILVER', dev:5},
						{playing:false, name:'Harry Potter', tear:'MASTER', dev:1},
						{playing:false, name:'Trident', tear:'PLATINUM', dev:2},
						{playing:false, name:'US Economy', tear:'DIAMOND', dev:1},
						{playing:false, name:'ddog', tear:'GOLD', dev:4},
						{playing:false, name:'distruction66', tear:'DIAMOND', dev:1},
						{playing:false, name:'Stratogy', tear:'SILVER', dev:5},
						{playing:false, name:'Blank', tear:'BRONZE', dev:1},
						{playing:false, name:'phoenixteam', tear:'GOLD', dev:5}
			];
			sortFriendsList();
			num_players = 0;
			

			$("#listing").show();
			$("#balanced").hide();

			configure_balance_button();
			display_friends(friends);

			var modal = document.getElementById('modal-wrapper');
        	window.onclick = function(event) {
            	if (event.target == modal) {
                	modal.style.display = "none";
            	}
        	}

		}); // end document.ready 

		function printPlayerNum() {
			var countIndicator = $("#num_players");
			var btn = $("#balance_btn");
			if (num_players < 10) {
				countIndicator.removeClass("error-text success-text");
				btn.prop("disabled",true);
			} else if (num_players > 10) {
				countIndicator.removeClass("success-text").addClass("error-text");
				btn.prop("disabled",true);
			} else {
				countIndicator.removeClass("error-text").addClass("success-text");
				btn.prop("disabled",false);
			}
			countIndicator.text(num_players + "/10");
		}
		function incrementPlayers() {
			num_players += 1;
			printPlayerNum();
			return num_players;
		}
		function decrementPlayers() {
			num_players -= 1;
			printPlayerNum();
			return num_players;
		}
		
		function removePlayerFromActive(name) {
			$("#waiting-list").children(":contains('"+name+"')").remove();
			var player = friends.filter(entry => entry.name == name)[0];
			if (player.playing) {
				decrementPlayers();
			}
			player.playing = false;
		}

		function removePlayer(name) {
			//console.log("Before removing friends has size " + friends.length);
			$("#waiting-list").children(":contains('"+name+"')").remove();
			var player = friends.filter(entry => entry.name == name)[0];
			if (player.playing) {
				decrementPlayers();
			}
			player.playing = false;
			var index;
			for (var i=0; i<friends.length; i++) {
				if (friends[i].name === name) {
					index = i;
				}
			}
			if (index > -1) {
				friends.splice(index, 1);
				//console.log("Removed " + name + " and now friends has size " + friends.length);
			}
			else {
				console.log("Couldn't remove player " + name + " at index " + index);
			}
		}
		function appendPlayer(player) {
			var image = document.createElement("IMG");
			image.className = 'profile-icon';
			var name = encodeURI(player.name);
			//var newsrc = encodeURI("http://ddragon.leagueoflegends.com/cdn/6.24.1/img/profileicon/" + player.profileID + ".png");
			image.src = "http://avatar.leagueoflegends.com/na/" + name  + ".png";
			
			var node = document.createElement("LI");
			node.style.position = "relative";
			var textnode = document.createTextNode(player.name);
			var span = document.createElement("SPAN");
			span.className = 'close';
			span.title='Remove Card'
			{
				var xtext = document.createTextNode("×")
				function cardFunc(e) {
					index = getIndexByName(player.name);
					var card = $("#friends-list").children("li:contains('"+player.name+"')");
					//console.log("card: " + card.html());
					
					//$("#friends-list").children(":contains('"+player.name+"')").className = 'up';
					
					removePlayerFromActive(friends[index].name);
					console.log("Removed " + player.name + " from active");
					card.className = 'up';
					card.attr("class", "up");
					
				} 
				if (span.addEventListener) {
					span.addEventListener("click", cardFunc);
				} else if (span.attachEvent) {
					span.attachEvent("click", cardFunc);
				} else {
					console.log("X butten event not added");
				}
				span.appendChild(xtext);
			}
			
			node.appendChild(image);
			node.appendChild(textnode);
			node.appendChild(span);
			document.getElementById("waiting-list").appendChild(node);
		}

		function appendFriend(index, name, rank_str, rank_img_src) {
			var item = document.createElement("LI");             // Create a <li> item
			if (friends[index].playing) {
				item.className = 'down';
			} else {
				item.className = 'up';
			}

			{
				var card = document.createElement("DIV");			  // Create a dev
				card.className = 'flex-container friend-card'
				{
					var body = document.createElement("DIV");
					body.className = 'card-body';
					{
						var title = document.createElement("H4");
						title.className = 'card-title unselectable';
						{
							var textnode = document.createTextNode(name);
							textnode.className = 'unselectable';
							title.appendChild(textnode);
						}

						var paragraph = document.createElement("P");
						paragraph.className = 'card-text unselectable';
						{
							var textnode = document.createTextNode(rank_str);
							textnode.className = 'unselectable';
							paragraph.appendChild(textnode);
						}
						body.appendChild(title)
						body.appendChild(paragraph)
					}

					var image = document.createElement("IMG");
					image.className = 'card-img-right';
					image.src = rank_img_src;

					var span = document.createElement("SPAN");
					span.className = 'close';
					span.title='Remove Card'
					
					{
						var textnode = document.createTextNode("×")
						function removeFunc () {
							//console.log("removing " + name + " from list at index " + index);
							removePlayer(name);
							document.getElementById("friends-list").removeChild(item);
						}
						if (span.addEventListener) {
							span.addEventListener("click", removeFunc);
						} else if (span.attachEvent) {
							span.attachEvent("click", removeFunc);
						} else {
							console.log("X butten event not added");
						}
						span.appendChild(textnode);
					}

					card.appendChild(body);
					card.appendChild(image);
					card.appendChild(span);
					{
						function cardFunc(e) {
							if (e.target.tagName.toLowerCase() == "span"){return;}
							index = getIndexByName(name);
							if (friends[index].playing) {
								removePlayerFromActive(friends[index].name);
								item.className = 'up';
							} else {
								addPlayerToList(index);
								item.className = 'down';
							}
						} 

						if (card.addEventListener) {
							card.addEventListener("click", cardFunc); 
						} else if (card.attachEvent) {
							card.attachEvent("click", cardFunc); 
						} else {
							console.log("card event added");
						}
					}

				}
				item.appendChild(card);
			}
			$("#friends-list").append(item);
		}
		function showAddCard() {
			console.log("addCard");
		}
		
		/*
X0098 joined the lobby
Weíss Schnee joined the lobby
TommyMcBumbusta joined the lobby
Shallahallamalo joined the lobby
X Blade 18 joined the lobby
Sushi Machine joined the lobby
Soup1 joined the lobby
TNS DDushi joined the lobby
US Economy joined the lobby
TNS DDushi left the lobby
US Economy
ADV
:  hello
		*/
		function apiSummonerGroup() {
			var chatTextLines = $("#chat-box").val().toLowerCase().split('\n');
			console.log("Chat Text: " + chatTextLines);
			console.log("line num: " + chatTextLines.length);
			var line;
			var names = [];
			var nonames = [];
			var addname = true;
			var endIndex;
			var summName;
			for(var i = chatTextLines.length - 1; i >= 0; i--) {
				line = chatTextLines[i];
				console.log("line: " + line);
				addname = true;
				endIndex = line.search(" left the lobby");
				if (endIndex != -1) {
					if (!line.includes(":")) {
						summName = line.substring(0, endIndex);
						nonames.push(summName);
						console.log("found noname: " + summName);
					}
				}
				endIndex = line.search(" joined the lobby");
				if (endIndex != -1) {
					if (!line.includes(":")) {
						summName = line.substring(0, endIndex);
						console.log("found summName: " + summName);
						for(var j = 0; j < nonames.length; j++) {
							if (nonames[j].includes(summName)) {
								addname = false;
							}
						}
						if (addname) {
							console.log("adding summoner: " + summName);
							names.push(summName);
						}
					}
				}
				
			}
			
			for(var x = 0; x < names.length; x++) {
				apiSummoner(names[x], true);
			}
		}
		
		function passNameToAPI() {
			var summnerName = $("#name-box").val();
			return apiSummoner(summnerName, false);
		}

		function apiSummoner(summnerName, addToActive) {
			var apikey = "RGAPI-ee9841e3-437d-429a-96bf-b962e011b31a"
			console.log("summtolower: " + summnerName.toLowerCase());
			var alreadyAddedName;
			var nameExists = (friends.reduce(function (accumulator, currentValue) {
				if (currentValue.name.toLowerCase() === summnerName.toLowerCase()) {
					alreadyAddedName = currentValue.name;
					return true;
				}
				if (accumulator) {
					return true;
				}
				return false;
			}, false));
			if (nameExists) {
				reportSummonerNotAdded(alreadyAddedName + " is already in the friends list");
				if (addToActive) { 
					addToActivePlayers(summnerName);
                }

				return false;
			}
			const proxyurl = "https://cors-anywhere.herokuapp.com/";
			const url = encodeURI("https://na1.api.riotgames.com/lol/summoner/v3/summoners/by-name/" + summnerName + "?api_key=");
			console.log("fetching id for " + summnerName)
			$.getJSON(proxyurl + url + apikey, 
			function(data) {
				//data is the JSON string
				var summID = data.id;
				console.log("summonerID: " + summID);
				var actualName = data.name;
				if (actualName.substring(0,1) === " ") {
					actualName = actualName.substring(1,actualName.length);
				}
				console.log("actual name: " + actualName);
				const proxyurl2 = "https://cors-anywhere.herokuapp.com/";
				const url2 = 'https://na1.api.riotgames.com/lol/league/v3/positions/by-summoner/' + summID + '?api_key=';
				$.getJSON(proxyurl2 + url2 + apikey,
				function(data2) {
					//data2 is the JSON string
					var ranked = false;
					console.log("parsing second response:");
					data2.forEach(function(el) {
						//console.log(el.queueType);
						if (el.queueType == "RANKED_SOLO_5x5") {
							var tier = el.tier;
							var div = el.rank;
							ranked = true;
							console.log("Rank is " + tier + " " + div);
							if (isFriendAlreadyAdded(actualName)) {
								return false;
							}
							addToFriendsList(actualName, tier, div);
							display_friends();
							if (addToActive) {
								addToActivePlayers(actualName);
							}
						}
					});
					if (!ranked) {
						var tier = "UNRANKED";
						var div = 1;
						console.log("Unranked in Solo");
						if (isFriendAlreadyAdded(actualName)) {
							return false;
						}
						addToFriendsList(actualName, tier, div);
						display_friends();
						if (addToActive) {
                        	addToActivePlayers(actualName);
                        }
					}
				});
			});
			return false;
		}

		function reportSummonerNotAdded(msg) {
			console.log("Summoner exists in friends list: " + msg); //XXX
			var element = $("#feedback");
			var text = document.createTextNode(msg);
			element.empty();
			element.removeClass("success-text").addClass("error-text");
			element.append(text);
		}

		function reportSummonerAdded(summonerName) {
			console.log(summonerName + " has been added to the friends list");
			var element = $("#feedback");
			var text = document.createTextNode(summonerName + " has been added to the friends list");
			element.empty();
			element.removeClass("error-text").addClass("success-text");
			element.append(text);
		}

		function configure_balance_button() {
			var btn = $("#balance_btn");
			btn.click(showBalanceGrid);
			btn.html("Balance!");
			btn.prop("disabled",true);

			btn = $("#back_btn");
			btn.click(showPlayerList);
			btn.html("Back");
			btn.hide();
		}


		function findSummoner() {
			console.log("starting API call.. ");
		}

		function appendToTeam(teamName, player) {
			var item = document.createElement("LI");
			item.className = 'down';
			{
				var card = document.createElement("DEV");			  // Create a dev
				card.className = 'flex-container balance-card';
				{
					var body = document.createElement("DEV");
					body.className = 'card-body';
					{
						var title = document.createElement("P");
						title.className = 'card-title unselectable';
						{
							var textnode = document.createTextNode(player.name);
							title.appendChild(textnode);
						}

						var paragraph = document.createElement("H5");
						paragraph.className = 'card-text unselectable';
						{
							var textnode = document.createTextNode(getRankString(player.tear, player.dev));
							paragraph.appendChild(textnode);
						}
						body.appendChild(title)
						body.appendChild(paragraph)
					}

					var image = document.createElement("IMG");
					image.className = 'balance-img-right';
					image.src = getSrcByRank(player.tear);

					card.appendChild(body);
					card.appendChild(image);
				}
				item.appendChild(card);
			}
			document.getElementById(teamName).appendChild(item);
	  }

		function show_teams(score1, team1, score2, team2) {
			$("#team1").empty();
			$("#team1Strength").html(score1);
			$("#team2").empty();
			$("#team2Strength").html(score2);
			team1.forEach(function(player, index) {
				appendToTeam("team1", player);
			});
			team2.forEach(function(player, index) {
				appendToTeam("team2", player);
			});
		}

		function balanceTeams() {
			console.log("balancing started");
			activePlayers = friends.filter(friend => friend.playing);
			const BASE_MMR = 850.0;
			const BASE_MMR_COUNTER = 60.0;
			var bestTeam1 = [];
			var bestTeam2 = [];
			var bestTeam1MMR = 0;
			var bestTeam2MMR = 0;
			var bestdiff = 99999;
			var currdiff = 0;
			for (var n=0; n<1000; n++) {
				var team1MMR = 0;
				var team2MMR = 0;
				activePlayers = shuffle(activePlayers);
				var team1List = [];
				var team2List = [];
				var i = 0;
				while (i < activePlayers.length/2) {
					team2List.push(activePlayers[i*2]);
					team1List.push(activePlayers[(i*2)+1]);
					i++;
				}
	
				/* Check difference in MMR, keep best choice */
				for (var y = 0; y < team1List.length; y++) {
            	    team1MMR += getMMR(team1List[y]);
            	}
            	for (var z = 0; z < team2List.length; z++) {
            	    team2MMR += getMMR(team2List[z]);
            	}
            	currdiff = (team1MMR > team2MMR) ? team1MMR - team2MMR : team2MMR - team1MMR;
            	if (currdiff < bestdiff) {
                	bestdiff = currdiff;
                	bestTeam1 = team1List;
                	bestTeam2 = team2List;
					bestTeam1MMR = team1MMR;
					bestTeam2MMR = team2MMR;
                	//PrintToSortedTeam(team1View, bestTeam1);
                	//PrintToSortedTeam(team2View, bestTeam2);
                	//team1Strength.setText((getString(R.string.strength) + " " + team1MMR));
                	//team2Strength.setText((getString(R.string.strength) + " " + team2MMR));
            	}
			}
			//bestTeam1 and bestTeam2 are ready for deployment!
			console.log("Team 1 (" + bestTeam1MMR + ") : " + bestTeam1);
			console.log("Team 2 (" + bestTeam2MMR + ") : " + bestTeam2);
			show_teams(bestTeam1MMR, bestTeam1, bestTeam2MMR, bestTeam2);
		}

		function getMMR(player) {
			const BASE_MMR = 850.0;
            const BASE_MMR_COUNTER = 60.0;
			var rankOrdinal = 0;
			var rank = player.tear;
			var div = player.dev;
			switch(div) {
				case "I":
                    rankOrdinal += 4;
                    break;
				case "II":
                    rankOrdinal += 3;
                    break;
                case "III":
                    rankOrdinal += 2;
                    break;
                case "IV":
                    rankOrdinal += 1;
                    break;
			}
			switch(rank) {
				case "BRONZE":
					rankOrdinal += 1;
					break;
				case "SILVER":
					rankOrdinal += 6;
					break;
				case "GOLD":
                    rankOrdinal += 11;
                    break;
				case "PLATINUM":
                    rankOrdinal += 16;
                    break;
				case "DIAMOND":
                    rankOrdinal += 21;
                    break;
				case "MASTER":
                    rankOrdinal = 26;
                    break;
				case "CHALLENGER":
                    rankOrdinal = 27;
                    break;
			}
			var totalRanks = 28;
			var multiplier = 1.0 + (0.3 * (rankOrdinal / (totalRanks-2)));
			var floatMMR = (BASE_MMR + (BASE_MMR_COUNTER * multiplier * rankOrdinal));
			var MMR = parseInt(floatMMR, 10);
			return MMR;
		}
		
		function shuffle(a) {
    		var j, x, i;
    		for (i = a.length - 1; i > 0; i--) {
        		j = Math.floor(Math.random() * (i + 1));
        		x = a[i];
        		a[i] = a[j];
        		a[j] = x;
   			}
    		return a;
		}
	</script>

</head>

<header >
	<div style="display:flex;">
		<img src="images/LoLBalance.png" alt="Icon" style="max-height: 5vh; margin-left:2vw;">
		<h1 id="header-title" style="margin-left:1vw; margin-top:5px; margin-bottom:5px;">LoL Balance</h1>
	</div>
</header>
<body>
	<!-------------------------- POP-UP -------------------------->
	<div id="modal-wrapper" class="modal" style="display:none;" >
		<form class="modal-content animate" action="javascript:void(0);">
			<span onclick="document.getElementById('modal-wrapper').style.display='none'" class="close" title="Close PopUp">&times;</span>
			<div class="modalcontainer">
				<div class="tab">
					<button class="tablinks" onclick="openInput(event, 'Individual')"> Individual </button>
					<button class="tablinks" onclick="openInput(event, 'Group')"> Group </button>
				</div> <!-- .tab -->
				<div id="Individual" class="tabcontent">
					<!-- <img src="images/add_friend-512.png" alt="Avatar" class="avatar"> -->
					<h3 style="text-align:center"> Type Summoner name: </h3>
					<form action="javascript:void(0);" id="individualSearch" onSubmit="return passNameToAPI()">
						<input id="name-box" type="text" size="30" placeholder="Summoner Name..." class="text-in"/>
						<br/>
						<button onclick="passNameToAPI()" type="button" class="btn summoner-btn"><font size="6">Add Summoner</font></button>
					</form>
				</div> <!-- #Individual -->
				<div id="Group" class="tabcontent">
					<h3 style="text-align:center"> Copy-paste lobby chat: </h3>
					<form action="javascript:void(0);" id="groupSearch" onSubmit="return apiSummonerGroup()">
						<textarea id="chat-box" placeholder="Player joined the lobby..." name="Text1" cols="60" rows="5" class="text-in"></textarea>
						<br/>
						<button onclick="apiSummonerGroup()" type="button" class="btn summoner-btn"><font size="6">Add All</font></button>
					</form>
				</div> <!-- #Group -->
				<p id="feedback"></p>
			</div> <!-- .modalcontainer -->
		</form> <!-- .animate -->
	</div> <!-- #modal-wrapper -->


	<!---------------------- MAIN DISPLAY ARIEA ------------------>
	<div>
		<div class="jumbotron">
			<div id="listing" class="balance" style="">
				<p> Selected players: <span id="num_players">0/10</span></p>
				<ul id="waiting-list">
				</ul>
			</div>
			<input type="image" src="images/ally.png" class="icon-btn" id="link-btn" onclick="allyOnClick()" />
			<input type="image" src="images/rival.png" class="icon-btn" id="rival-btn" onclick="rivalOnClick()" />

			<div id="balanced" class="balance">
				<div class="flex-container">
					<div style="width:50%; ">
						<p>Team 1 (strength:<span id="team1Strength">0000</span>)</p>
						<ul  id="team1">
						</ul>
					</div>
					<div style="width:50%;">
						<p>Team 2 (strength:<span id="team2Strength">0000</span>)</p>
						<ul id="team2">
						</ul>
					</div>
				</div>
			</div>

		</div>
		<div style="text-align:center; margin-right:20vw;">
			<button id="balance_btn" type="button" class="btn btn-success" style="margin-left: 2vw;">NO_JAVASCRIPT</button>
			<button id="back_btn" type="button" class="btn" style="margin-left: 2vw;">NO_JAVASCRIPT</button>
		</div>
	</div>

	<!-------------------- FRIENDS SIDE WINDOW ------------------------>
	<div id="friends" class="right scrollable">
		<div class="search-container">
			<form onSubmit="display_friends(); return false;" style="padding-top:12px;">
				<input id="search-box" onchange="display_friends();"
				onkeyup="this.onchange();" onpaste="this.onchange();"
				oninput="this.onchange();" type="text" placeholder="Search..."/>
			</form>
			<!-- <input id="add-friend-button" type="image" onclick="showPopup()"> -->
			<img id="add-friend-button" src="images/add_friend_gold2-512.png" 
                onmouseover="this.src='images/add_friend_gold2dark-512.png'" 
                onmouseout="this.src='images/add_friend_gold2-512.png'"
                onclick="showPopup()">
		</div>
		<ul id="friends-list">
			<li>
				<div class="flex-container friend-card"> <!--style="width: 18rem;"-->
					<div class="card-body">
						<h5 class="card-title">Example</h5>
						<p class="card-text">
						rank
						</p>
					</div>
					<img class="card-img-right" src="images/UNRANKED.png" alt="Card image cap">
					<span onclick="document.getElementById('modal-wrapper').style.display='none'" class="close" title="Close PopUp">&times;</span>
				</div>
			</li>
		</ul>
	</div>

</body>
</html>

